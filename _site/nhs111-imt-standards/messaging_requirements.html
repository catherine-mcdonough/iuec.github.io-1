<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>
    
      Messaging Requirements -
    
    IUEC
  </title>

  <link type="text/css" rel="stylesheet" href="http://fast.fonts.net/cssapi/e3854e97-b35c-4f31-bf5d-f804408f2ef8.css"/>
  <link rel="stylesheet" type="text/css" href="/css/main.css">

  <!--[if lt IE 9]>
    <script src="/public/javascripts/vendor/html5shiv.js" type="text/javascript"></script>
    <script src="/public/javascripts/vendor/html5shiv-printshiv.js" type="text/javascript"></script>
  <![endif]-->

</head>
<body>

<div id="skiplink-container">
  <div>
    <a href="#content">Skip to main content</a>
  </div>
</div>

<div id="global-cookies-banner" role="alert">
  <p>
    NHS.UK uses cookies to make the site simpler.
    <a href="/help/cookies">Find out more about cookies</a>
  </p>
</div>

<header role="banner" id="global-header">
  <div class="header-container">
    <a href="/" class="header-logo" title="Go to the NHS.UK homepage">
      <img src="/images/nhs-logotype.svg" alt="NHS" width="90" height="36">
    </a>
  </div>
</header>

<div class="phase-banner">
  <p>
    <b>Noticed that something needs improving?</b> Submit your change on <a href="https://github.com/iuec/iuec-tech-standards"> Github</a> or email your contribution to <a href="mailto:m.stibbs@nhs.net">m.stibbs@nhs.net</a>.
  </p>
</div>

<main id="content" class="block-container" role="main" tabindex="-1">
	<div class="go-back-link">
    <a href="/nhs111-imt-standards">&#171; Go back</a>
  </div>
  <div class="breadcrumbs">
    <p>NHS111 IMT Standards /  <b><u>Messaging Requirements</u></b></p>
  </div>
    <nav class="numbered-navigation" role="navigation">
      <h1>Messaging Requirements</h1>
    </nav>
	<div class="content-measure">
		  <p>Note that this section makes extensive reference to ITK Specifications. These may be
obtained from the TRUD download service, see https://www.uktcregistration.nss.cfh.nhs.uk.
(Further assistance with TRUD may be obtained from the Data Standards and Products
Helpdesk at <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#097;&#116;&#097;&#115;&#116;&#097;&#110;&#100;&#097;&#114;&#100;&#115;&#064;&#110;&#104;&#115;&#046;&#110;&#101;&#116;">&#100;&#097;&#116;&#097;&#115;&#116;&#097;&#110;&#100;&#097;&#114;&#100;&#115;&#064;&#110;&#104;&#115;&#046;&#110;&#101;&#116;</a>.</p>

<p>The relevant TRUD packages are:</p>

<ul>
  <li>
    <p><strong>NHS 111 Version: 1.0; Status: - RC2 Domain Message Specification under NHS
MESSAGE SPECIFICATIONS</strong> – the 111 messaging payload specifications</p>
  </li>
  <li>
    <p><strong>nhs_itkcore</strong> - the ITK core specifications, including web services transport</p>
  </li>
  <li>
    <p><strong>nhs_itkaccreditation</strong> – details of the ITK accreditation process</p>
  </li>
</ul>

<h3 id="msg1-payload-specifications">4.1 MSG.1 Payload specifications</h3>
<p>Message payloads MUST be conformant with the 111 message definitions</p>

<p>These are specified in NHS 111 Version: 1.0; Status: - RC2 Domain Message Specification
under NHS MESSAGE SPECIFICATIONS.</p>

<h3 id="msg2-itk-distribution-envelope">4.2 MSG.2 ITK Distribution Envelope</h3>
<p>Messages MUST wrap the 111 message in an ITK Distribution Envelope.</p>

<p>Usage of the Distribution Envelope is also specified in <strong>nhs_itkcore</strong>.</p>

<h3 id="msg3-itk-messaging-architecture">4.3 MSG.3 ITK Messaging Architecture</h3>
<p>All 111 messaging implementations MUST be compliant with the ITK Messaging Architecture
specification.</p>

<p>The document “<strong>NPFIT-ELIBR-AREL-DST-0433.01 ITK 2.0 Messaging Architecture v2.0</strong>”
(see nhs_itkcore pack) provides further detail about use of the Distribution Envelope, and other generic aspects of ITK message handling (eg versioning, reliable handling). The
requirements in this document MUST be complied with.</p>

<p>(Note that for the purposes of initial 111 go-live then the messaging security requirements (COR-SEC-01 through COR-SEC-05) may be considered to be adequately covered by the approach based on TLS Mutual Authentication that is described in requirement <strong>MSG.6</strong> below).</p>

<h3 id="msg4-itk-web-services-transport">4.4 MSG.4 ITK Web Services Transport</h3>
<p>All 111 messaging implementations MUST be compliant with the ITK Web Services
Transport Specification.</p>

<p>The document “<strong>NPFIT-ELIBR-AREL-DST-0430.02 ITK 2.0 Web Services Transport
Specification v3.0</strong>” (see nhs_itkcore pack) provides further detail about the ITK web
services transport. The requirements in this document MUST be complied with, with the exception of the requirements listed below which MAY be omitted for initial 111 go-live:</p>

<ul>
  <li>
    <p>The following requirements may be excepted for initial 111 go-live as they are not
relevant as they relate to messaging patterns that are not currently needed by 111:</p>

    <ul>
      <li>
        <p><strong>WS-PAT-02</strong>: Toolkit Web Services MUST use the Asynchronous Invocation style for Pattern 1 services where this is specified</p>
      </li>
      <li>
        <p><strong>WS-PAT-03</strong>: Toolkit Web Services MUST use the Synchronous Invocation Pattern for Pattern 2 services</p>
      </li>
      <li>
        <p><strong>WS-PAT-04</strong>: The SimpleMessageResponse MUST contain simple acknowledgement
 of a Pattern 2 request</p>
      </li>
    </ul>
  </li>
  <li>
    <p>The following requirements are security related, and may be excepted for initial 111 go-
live, as an alternative, simplified, security approach has been defined for 111 (see <strong>MSG.6</strong>
below):</p>

    <ul>
      <li>
        <p><strong>WS-SEC-03</strong>: Toolkit Implementations MUST sign the message timestamp</p>
      </li>
      <li>
        <p><strong>WS-SEC-07</strong>: Toolkit Implementations MUST be able to authenticate a requestor’s identity</p>
      </li>
      <li>
        <p><strong>WS-SEC-08</strong>: Toolkit Implementations MUST be able to authorise a service request, based on the Service and the Requestor’s identity</p>
      </li>
      <li>
        <p><strong>WS-DSC-15</strong>: The timestamp element of the SOAP Header MUST be signed</p>
      </li>
      <li>
        <p><strong>WS-DSC-05</strong>: Canonicalization method MUST be present in the signature</p>
      </li>
      <li>
        <p><strong>WS-DSC-06</strong>: PKI certificates MUST be used for message signing</p>
      </li>
      <li>
        <p><strong>WS-DSC-17</strong>: PKI certificates MUST be from a recognised CA</p>
      </li>
      <li>
        <p><strong>WS-DSC-18</strong>: Toolkit middleware and applications MUST preinstall all CA root certificates that are listed in the Microsoft Trusted Root Certificate Store.</p>
      </li>
      <li>
        <p><strong>WS-DSC-19</strong>: Toolkit middleware and applications MUST preinstall the NHS CA Root Certificate</p>
      </li>
      <li>
        <p><strong>WS-DSC-20</strong>: Toolkit middleware and applications MAY preinstall the Root Certificate from other CAs that they choose to trust</p>
      </li>
      <li>
        <p><strong>WS-DSC-21</strong>: Toolkit middleware and applications MUST verify the certificate Thumbprint against an approved list</p>
      </li>
      <li>
        <p><strong>WS-DSC-09</strong>: Detached signatures SHOULD be used if XML Signature is utilised</p>
      </li>
      <li>
        <p><strong>WS-DSC-10</strong>: KeyInfo element MUST use SecurityTokenReference</p>
      </li>
      <li>
        <p><strong>WS-DSC-14</strong>: The X509 certificate MUST be included in the BinarySecurityToken element</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="msg5-full-itk-compliance">4.5 MSG.5 Full ITK Compliance</h3>
<p>All 111 messaging implementations SHOULD gain full “ITK Application” Accreditation, including support for the 111 messaging payload bundle.</p>

<p>In practice this will involve, in addition to the above, implementing the remaining requirements in the “itk_core” pack – see “<strong>NPFIT-ELIBR-AREL-DST-0422.02 ITK 2.0 Specifications Overview v2.0</strong>” for details of the additional ITK requirements modules that are relevant to this.</p>

<h3 id="msg6-security-based-on-tls-mutual-authentication">4.6 MSG.6 Security based on TLS Mutual Authentication</h3>
<p>The 111 service requires “any-to-any” connections between nodes: call handlers and service providers. Connections are made under the direction of information in the 111 directory of service. The size of the handler and provider population, and the requirement to be able to add handlers and providers with a minimum of disruption, argues against reliance on firewalls to restrict connection access. To use firewalls, would require significant reconfiguration across the estate each time a handler or provider is added.</p>

<p>An alternative is to open a single firewall port on each 111 node and rely on certificates and mutually-authenticated TLS to secure connections. This works by requiring that all 111 nodes have a certificate which is identifiable, and trustworthy as, belonging to a bona fide 111 node. On receipt, a connection will only be accepted if it is secured with a certificate that is trustworthy as being from another 111 node. Sites are configured to use this simply by installing the certificate authority certificates, in their platform. Port 1879 has been agreed as the port that will be used by all parties for 111 messaging.</p>

<p>Such trustworthiness is assured by the “policy” which guards the issuance of a certificate to a 111 site. At the time of initial rollout, there is no such established policy which completely assures the identity of a 111 node – delivery of that policy is dependent on a PKI project with a longer delivery timescale than NHS 111.</p>

<p>As an interim, Spine certificates will be used. Spine certificates are signed by a nationally-recognised Certificate Authority, and protected by a policy which identifies sites for connection to Spine. On their own, Spine certificates do not identify a site as a 111 node. However, to create a Spine certificate the Fully Qualified Domain Name (FQDN) and associated IP address of the site must be provided, and the policy enforces this. Therefore, by controlling access to an aspect of the FQDN, the 111 programme ensures that the certificate issued by Spine, identifies the holder as a 111 node.</p>

<p>This will be done by placing all 111 nodes under the subdomain “oneoneone.nhs.uk” – control of that subdomain provides the additional 111-specific policy around the issuance of Spine certificates, that makes a 111-specific certificate trustworthy as such.</p>

<p>On receipt of a connection request, an NHS 111 endpoint will only accept the connection
if it is secured by a Spine-issued certificate that has a CN containing an FQDN of the form
nodename.oneoneone.nhs.uk. In more detail these checks comprise of:</p>

<ul>
  <li>
    <p>Full certificate path validation and revocation check by both client and server (client and server stated in the context of the TLS Protocol but in essence, both parties perform verification and validation of each others presented certificates)</p>
  </li>
  <li>
    <p>Check the validity of the dates within the certificates presented</p>
  </li>
  <li>
    <p>Check that the certificate being presented is one which has been issued to a 111 node
(i.e. has a CN containing an FQDN of the form nodename.oneoneone.nhs.uk)</p>
  </li>
  <li>
    <p>Check the issuer of the presented certificate and that should include checking of
Authority Key ID and Subject Key ID</p>
  </li>
</ul>

<p>Note that using the FQDN to provide additional identification for a 111 endpoint is a tactical solution and MAY be subject to changes in future policy regarding DNS or use of the 111 services. For example use of the FQDN check might become redundant at such time as 111 security policy is handled via the processes that protect issuance of certificates against a specific 111 sub CA. To avoid undue impact on deployed systems, vendors MUST allow the FQDN checks to be configured such that they can be “turned off” without the need to deploy changed code.</p>

<h3 id="msg7-direct-synchronous-connection">4.7 MSG.7 Direct, synchronous connection</h3>
<p>To be able to fulfil the requirements for 111 messaging the following properties of the interaction must exist:</p>

<ul>
  <li>
    <p>The interface MUST be synchronous from the perspective of an HTTPS connection. The request and response are communicated over the same HTTPS connection and the user must be conscious of the message response in real time.</p>
  </li>
  <li>
    <p>The service caller and provider MUST NOT communicate via an intermediary.</p>
  </li>
</ul>

<h3 id="msg8-endpoint-addressing">4.8 MSG.8 Endpoint Addressing</h3>
<p>Messages to service providers (eg Out of Hours, Ambulance) will be addressed to the service provider’s endpoint for receiving 111 messages. This service provider endpoint MUST be as retrieved from the 111 Directory of Service (DoS). The location of the DoS itself MUST be a configurable item.</p>

<p>Messages to the Repeat Caller Database will be addressed to a single well-known endpoint.
The details of this Repeat Caller Database endpoint MUST be a configurable item.</p>

	</div>
  <div class="go-back-link">
    <a href="/nhs111-imt-standards">&#171; Go back</a>
  </div>
</main>

<footer id="global-footer" role="contentinfo">
  <div class="footer-container">
    <nav>
      <ul>
        <!--<li><a href="/help/cookies">Cookies</a></li>-->
      </ul>
    </nav>

    <p>
      &copy; Crown copyright<br>
      Content available under <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">Open Government Licence v3.0.</a>
    </p>
  </div>
</footer>

<!-- Commented out the google analytics until we are ready to use -->
<!--<script type="text/javascript" src="/public/javascripts/cookies.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'XX-XXXXXXXX-X', 'auto');
  ga('send', 'pageview');
</script>-->

</body>
</html>
